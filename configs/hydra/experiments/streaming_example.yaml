# @package _global_
defaults:
  - override /model: large
  - override /data: production_streaming  # Uses streaming mode
  - override /training: production

# Override specific training settings for streaming compatibility
training:
  output_dir: ./outputs/streaming_model
  max_steps: -1  # Let epochs control training length

  # Evaluation strategy for streaming
  eval_strategy: steps
  eval_steps: 1000  # Evaluate every 500 steps
  save_strategy: steps
  save_steps: 1000


  # Logging
  logging_steps: 50
  logging_first_step: true
  report_to: tensorboard

  # Performance settings
  per_device_train_batch_size: 4
  per_device_eval_batch_size: 4
  gradient_accumulation_steps: 8

  # Streaming datasets don't support dataloader_num_workers > 0
  dataloader_num_workers: 6
  dataloader_persistent_workers: true

  # Memory optimization
  gradient_checkpointing: true
  fp16: false
  bf16: true

# Data configuration for streaming
data:
  use_streaming: true
  max_train_samples: null  # Process full dataset in streaming mode
  max_eval_samples: 500  # Limit eval samples for faster evaluation